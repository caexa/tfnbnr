<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tfnbnr – study together</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <style>
    :root{
      --accent:#f43f5e;--accent-light:#fb7185;
      --bg:#ffffff;--card:#fafafa;--text:#111827;--muted:#6b7280;
      --radius:12px;--shadow:0 4px 12px rgba(0,0,0,.06);
    }
    body.dark{--bg:#111827;--card:#1f2937;--text:#f9fafb;--muted:#9ca3af;}
    *{box-sizing:border-box;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
    body{background:var(--bg);color:var(--text);line-height:1.55;padding:0 .75rem 2rem;transition:background .3s,color .3s}
    header{display:flex;align-items:center;justify-content:space-between;padding:1.25rem 0 .5rem}
    h1{font-size:1.85rem;font-weight:800;letter-spacing:-.5px}
    .toggle{appearance:none;width:44px;height:24px;background:var(--muted);border-radius:999px;position:relative;cursor:pointer}
    .toggle::after{content:"";position:absolute;width:20px;height:20px;background:#fff;border-radius:50%;top:2px;left:2px;transition:.3s}
    .toggle:checked{background:var(--accent)}.toggle:checked::after{transform:translateX(20px)}
    nav{display:flex;gap:.5rem;margin:.75rem 0 1.5rem;flex-wrap:wrap}
    nav button{flex:1 1 120px;padding:.55rem;border:none;border-radius:var(--radius);background:var(--card);color:var(--text);font-weight:600;cursor:pointer;box-shadow:var(--shadow);transition:.2s}
    nav button.active{background:var(--accent);color:#fff}
    main{max-width:900px;margin:0 auto}
    .view{display:none}.view.active{display:block}
    section{background:var(--card);border-radius:var(--radius);padding:1.25rem 1.5rem 1.5rem;box-shadow:var(--shadow);margin-bottom:1.25rem}
    label{font-size:.8rem;color:var(--muted);display:block;margin-bottom:.25rem}
    select,input{width:100%;padding:.55rem .65rem;border:1px solid #d1d5db;border-radius:var(--radius);font-size:.95rem;margin-bottom:.9rem}
    .row{display:flex;gap:.5rem}
    .row .field{flex:1}
    button.cta{width:100%;padding:.7rem;border:none;border-radius:var(--radius);background:var(--accent);color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:.2s}
    button.cta:hover{background:var(--accent-light)}
    .progress-bar{height:10px;background:#e5e7eb;border-radius:5px;overflow:hidden;margin-top:.4rem}
    .progress-bar div{height:100%;background:var(--accent);width:0%;transition:width .4s}
    .room{display:flex;gap:1rem;align-items:center}.room>div{flex:1}
    .leader-item{display:flex;justify-content:space-between;align-items:center;padding:.6rem 0;border-bottom:1px solid #e5e7eb}
    .leader-item:last-child{border:none}
    #authSection{text-align:center;margin-bottom:1rem}
  </style>
</head>
<body>
  <header>
    <h1>tfnbnr</h1>
    <div>
      <label><input type="checkbox" class="toggle" id="darkToggle"> Dark</label>
    </div>
  </header>

  <div id="authSection">
    <button class="cta" id="googleBtn">Sign in with Google</button>
    <button class="cta" id="mailBtn">Sign in with e-mail link</button>
    <p id="userP"></p>
    <button class="cta hidden" id="outBtn">Sign out</button>
  </div>

  <nav id="nav" class="hidden">
    <button class="active" data-view="solo">Solo</button>
    <button data-view="compete">1-v-1</button>
    <button data-view="leader">Leaders</button>
    <button data-view="profile">Profile</button>
  </nav>

  <main id="main" class="hidden">
    <!-- solo -->
    <div class="view active" id="solo">
      <section>
        <h2>Solo Focus Timer</h2>

        <label>Course</label>
        <select id="soloCourse"></select>

        <div class="row">
          <div class="field">
            <label for="soloMinutes">Minutes</label>
            <input id="soloMinutes" type="number" min="0" max="999" step="1" value="25" />
          </div>
          <div class="field">
            <label for="soloSeconds">Seconds (0–59)</label>
            <input id="soloSeconds" type="number" min="0" max="59" step="1" value="0" />
          </div>
        </div>

        <button class="cta" id="startSolo">Start focus</button>
        <button class="cta" id="resetSolo" style="margin-top:.5rem;background:#6b7280">Reset</button>

        <div class="progress-bar"><div id="soloProgress"></div></div>
        <p style="text-align:center;margin-top:.5rem;font-size:1.5rem;font-weight:700" id="soloTimer">25:00</p>
      </section>
    </div>

    <!-- 1v1 -->
    <div class="view" id="compete">
      <section>
        <h2>Find a live opponent</h2>
        <label>Course</label><select id="compCourse"></select>
        <button class="cta" id="findMatch">Find match</button>
        <div id="matchArea"></div>
      </section>
    </div>

    <!-- leaders -->
    <div class="view" id="leader">
      <section><h2>Daily Solo Leaders</h2><div id="soloLeader"></div></section>
      <section><h2>Competitive Wins</h2><div id="compLeader"></div></section>
    </div>

    <!-- profile -->
    <div class="view" id="profile">
      <section>
        <h2>Your Card</h2>
        <p><strong id="cardName">—</strong></p>
        <p>Focus minutes: <b id="cardMin">0</b></p>
        <p>Wins: <b id="cardWins">0</b></p>
        <p>Level: <b id="cardLvl">Rookie</b></p>
        <button class="cta" id="resetProf">Reset my data</button>
      </section>
    </div>
  </main>

  <!-- Firebase Auth -->
  <script type="module" src="tfnbnr.js"></script>

  <!-- Focus Timer Logic -->
  <script type="module">
  const $ = (sel) => document.querySelector(sel);

  const startBtn = $("#startSolo");
  const resetBtn = $("#resetSolo");
  const minutesInput = $("#soloMinutes");
  const secondsInput = $("#soloSeconds");
  const timerText = $("#soloTimer");
  const progressFill = $("#soloProgress");

  let timerState = "idle"; // idle | running | paused
  let startEpoch = 0;
  let elapsed = 0;
  let duration = 25 * 60 * 1000; // default 25:00
  let rafId = null;

  function clamp(val, lo, hi) {
    return Math.max(lo, Math.min(hi, Number.isFinite(val) ? val : 0));
  }

  function fmt(tMs) {
    const s = Math.max(0, Math.ceil(tMs / 1000));
    const m = Math.floor(s / 60).toString().padStart(2, "0");
    const ss = (s % 60).toString().padStart(2, "0");
    return `${m}:${ss}`;
  }

  function readInputs() {
    const mins = clamp(Number(minutesInput?.value), 0, 999);
    let secs = clamp(Number(secondsInput?.value), 0, 59);
    // Avoid 0:00 => bump to 00:01
    if (mins === 0 && secs === 0) secs = 1;
    // Write back clamped values for UX consistency
    if (minutesInput) minutesInput.value = String(mins);
    if (secondsInput) secondsInput.value = String(secs);
    return { mins, secs };
  }

  function setDurationFromInput() {
    const { mins, secs } = readInputs();
    duration = (mins * 60 + secs) * 1000;
    if (timerState === "idle") {
      timerText.textContent = fmt(duration);
      progressFill.style.width = "0%";
    }
  }

  function updateProgressUI(remainingMs) {
    const pct = 100 - Math.min(100, (remainingMs / duration) * 100);
    progressFill.style.width = `${pct}%`;
    timerText.textContent = fmt(remainingMs);
  }

  function tick() {
    const now = Date.now();
    const runningElapsed = now - startEpoch;
    const totalElapsed = elapsed + runningElapsed;
    const remaining = Math.max(0, duration - totalElapsed);
    updateProgressUI(remaining);

    if (remaining <= 0) {
      cancelAnimationFrame(rafId);
      rafId = null;
      timerState = "idle";
      elapsed = 0;
      startBtn.textContent = "Start focus";
      minutesInput.disabled = false;
      secondsInput.disabled = false;
      progressFill.style.width = "100%";
      timerText.textContent = "00:00";
      if (navigator.vibrate) navigator.vibrate(200);
      alert("Focus session complete!");
      return;
    }
    rafId = requestAnimationFrame(tick);
  }

  function start() {
    if (timerState === "running") return;
    if (timerState === "idle") {
      setDurationFromInput();
      elapsed = 0;
      progressFill.style.width = "0%";
    }
    startEpoch = Date.now();
    timerState = "running";
    startBtn.textContent = "Pause";
    minutesInput.disabled = true;
    secondsInput.disabled = true;
    rafId = requestAnimationFrame(tick);
  }

  function pause() {
    if (timerState !== "running") return;
    cancelAnimationFrame(rafId);
    rafId = null;
    elapsed += Date.now() - startEpoch;
    timerState = "paused";
    startBtn.textContent = "Resume";
  }

  function reset() {
    cancelAnimationFrame(rafId);
    rafId = null;
    timerState = "idle";
    elapsed = 0;
    minutesInput.disabled = false;
    secondsInput.disabled = false;
    setDurationFromInput();
    startBtn.textContent = "Start focus";
    progressFill.style.width = "0%";
  }

  // Clamp seconds live so users can't type 75, etc.
  secondsInput?.addEventListener("input", () => {
    const v = clamp(Number(secondsInput.value), 0, 59);
    if (String(v) !== secondsInput.value) secondsInput.value = String(v);
  });

  startBtn?.addEventListener("click", () => {
    if (timerState === "idle" || timerState === "paused") start();
    else if (timerState === "running") pause();
  });
  resetBtn?.addEventListener("click", reset);
  minutesInput?.addEventListener("change", setDurationFromInput);
  secondsInput?.addEventListener("change", setDurationFromInput);

  // Initialize UI
  setDurationFromInput();
  </script>
</body>
</html>

